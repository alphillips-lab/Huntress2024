# X-RAY

## Description

<small>Author: @JohnHammond</small><br><br>The SOC detected malware on a host, but antivirus already quarantined it... can you still make sense of what it does? <br><br> <b>NOTE: Archive password is <code>infected</code></b> <br><br> <b>Download the file(s) below.</b>


## Files

* [x-ray.7z](<files/x-ray.7z>)

## Solution

This is a piece of malware that was quarantined by Microsoft Defender.

I made a custom refinery unit to decrypt these. At the time of writing it is only in my personal fork:
https://github.com/binref/refinery/compare/master...alphillips-lab:refinery:feature-ms-defender-quarantine-files#diff-4a5376b10b56e3a362c5e6a8f1a63b3139603e1af3edbf7f5c0765da7443f75d

Decrypting the file yields a .NET binary. Looking through the .NET there is a peice of code that XOR's two hex strings. This is where the flag is stored.

We can do the same:
```
emit x-ray|r.msdqt |r.dnstr
```

Look for the following strings:
```
15b279d8c0fdbd7d4a8eea255876a0fd189f4fafd4f4124dafae47cb20a447308e3f77995d3c
73de18bfbb99db4f7cbed3156d40959e7aac7d96b29071759c9b70fb18947000be5d41ab6c41
```

XOR them:
```
emit h:73de18bfbb99db4f7cbed3156d40959e7aac7d96b29071759c9b70fb18947000be5d41ab6c41 |r.xor h:15b279d8c0fdbd7d4a8eea255876a0fd189f4fafd4f4124dafae47cb20a447308e3f77995d3c
```